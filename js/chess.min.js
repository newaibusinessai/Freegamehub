class ChessGame{constructor(){this.board=[];this.selectedPiece=null;this.turn='white';this.moves=0;this.gameOver=!1;this.initBoard();this.renderBoard();this.attachEventListeners()}initBoard(){this.board=Array(8).fill(null).map(()=>Array(8).fill(null));const blackPieces=['♜','♞','♝','♛','♚','♝','♞','♜'];for(let i=0;i<8;i++){this.board[0][i]={piece:blackPieces[i],color:'black'};this.board[1][i]={piece:'♟',color:'black'}}const whitePieces=['♖','♘','♗','♕','♔','♗','♘','♖'];for(let i=0;i<8;i++){this.board[6][i]={piece:'♙',color:'white'};this.board[7][i]={piece:whitePieces[i],color:'white'}}}renderBoard(){const boardEl=document.getElementById('chess-board');boardEl.innerHTML='';for(let row=0;row<8;row++){for(let col=0;col<8;col++){const square=document.createElement('div');square.className='chess-square';if((row+col)%2===0){square.classList.add('light')}else{square.classList.add('dark')}square.dataset.row=row;square.dataset.col=col;const piece=this.board[row][col];if(piece){const pieceEl=document.createElement('div');pieceEl.className=`chess-piece ${piece.color}`;pieceEl.textContent=piece.piece;pieceEl.dataset.row=row;pieceEl.dataset.col=col;square.appendChild(pieceEl)}square.addEventListener('click',e=>this.handleSquareClick(row,col,e));boardEl.appendChild(square)}}this.updateStatus()}handleSquareClick(row,col,e){if(this.gameOver)return;if(this.turn!=='white')return;const piece=this.board[row][col];if(this.selectedPiece){if(this.isValidMove(this.selectedPiece.row,this.selectedPiece.col,row,col)){this.movePiece(this.selectedPiece.row,this.selectedPiece.col,row,col);this.selectedPiece=null;document.querySelectorAll('.selected').forEach(el=>el.classList.remove('selected'));this.moves++;this.turn='black';this.renderBoard();setTimeout(()=>this.makeAIMove(),500)}else{if(piece&&piece.color===this.turn){this.selectedPiece={row,col,piece};document.querySelectorAll('.selected').forEach(el=>el.classList.remove('selected'));e.target.closest('.chess-square').classList.add('selected')}else{this.selectedPiece=null;document.querySelectorAll('.selected').forEach(el=>el.classList.remove('selected'))}}}else if(piece&&piece.color===this.turn){this.selectedPiece={row,col,piece};e.target.closest('.chess-square').classList.add('selected')}}isValidMove(fromRow,fromCol,toRow,toCol){const piece=this.board[fromRow][fromCol];const target=this.board[toRow][toCol];if(!piece)return!1;if(target&&target.color===piece.color)return!1;const rowDiff=Math.abs(toRow-fromRow);const colDiff=Math.abs(toCol-fromCol);const pieceType=piece.piece;if(pieceType==='♙'||pieceType==='♟'){const direction=piece.color==='white'?-1:1;if(toCol===fromCol&&!target){if(toRow===fromRow+direction)return!0;if((piece.color==='white'&&fromRow===6)||(piece.color==='black'&&fromRow===1)){if(toRow===fromRow+2*direction&&!this.board[fromRow+direction][fromCol])return!0}}if(colDiff===1&&toRow===fromRow+direction&&target)return!0}if(pieceType==='♘'||pieceType==='♞'){if((rowDiff===2&&colDiff===1)||(rowDiff===1&&colDiff===2))return!0}if(pieceType==='♖'||pieceType==='♜'){if(fromRow===toRow||fromCol===toCol){return this.isPathClear(fromRow,fromCol,toRow,toCol)}}if(pieceType==='♗'||pieceType==='♝'){if(rowDiff===colDiff){return this.isPathClear(fromRow,fromCol,toRow,toCol)}}if(pieceType==='♕'||pieceType==='♛'){if(fromRow===toRow||fromCol===toCol||rowDiff===colDiff){return this.isPathClear(fromRow,fromCol,toRow,toCol)}}if(pieceType==='♔'||pieceType==='♚'){if(rowDiff<=1&&colDiff<=1)return!0}return!1}isPathClear(fromRow,fromCol,toRow,toCol){const rowStep=toRow>fromRow?1:toRow<fromRow?-1:0;const colStep=toCol>fromCol?1:toCol<fromCol?-1:0;let currentRow=fromRow+rowStep;let currentCol=fromCol+colStep;while(currentRow!==toRow||currentCol!==toCol){if(this.board[currentRow][currentCol])return!1;currentRow+=rowStep;currentCol+=colStep}return!0}movePiece(fromRow,fromCol,toRow,toCol){const piece=this.board[fromRow][fromCol];const captured=this.board[toRow][toCol];this.board[toRow][toCol]=piece;this.board[fromRow][fromCol]=null;if((piece.piece==='♙'&&toRow===0)||(piece.piece==='♟'&&toRow===7)){this.board[toRow][toCol]={piece:piece.color==='white'?'♕':'♛',color:piece.color}}if(captured&&(captured.piece==='♔'||captured.piece==='♚')){this.gameOver=!0;setTimeout(()=>{alert(`${piece.color==='white'?'White':'Black'} wins!`)},100)}}makeAIMove(){if(this.gameOver)return;const validMoves=[];for(let fromRow=0;fromRow<8;fromRow++){for(let fromCol=0;fromCol<8;fromCol++){const piece=this.board[fromRow][fromCol];if(piece&&piece.color==='black'){for(let toRow=0;toRow<8;toRow++){for(let toCol=0;toCol<8;toCol++){if(this.isValidMove(fromRow,fromCol,toRow,toCol)){validMoves.push({fromRow,fromCol,toRow,toCol})}}}}}}if(validMoves.length>0){const randomMove=validMoves[Math.floor(Math.random()*validMoves.length)];this.movePiece(randomMove.fromRow,randomMove.fromCol,randomMove.toRow,randomMove.toCol);this.moves++;this.turn='white';this.renderBoard()}}updateStatus(){document.getElementById('turn').textContent=this.turn;document.getElementById('moves').textContent=Math.floor(this.moves/2)}reset(){this.board=[];this.selectedPiece=null;this.turn='white';this.moves=0;this.gameOver=!1;this.initBoard();this.renderBoard()}attachEventListeners(){document.getElementById('new-game').addEventListener('click',()=>this.reset())}}document.addEventListener('DOMContentLoaded',()=>{new ChessGame()});